环境搭建
============

Last updated: 12/08/2025. Author: cxiaolong

环境要求
------------
- **基础设施**: 当前仅支持昇腾A2、A3
- **Python版本**: 推荐使用Python3.10
- **CANN版本**: 推荐使用8.3.RC1

环境安装
------------

安装驱动固件
:::::::::::::

下载 `驱动固件 <https://www.hiascend.com/hardware/firmware-drivers/community?product=4&model=26&cann=8.3.RC1&driver=Ascend+HDK+25.3.0>`_ ，请根据系统和硬件产品型号选择对应版本的driver和firmware。参考 `安装NPU驱动固件 <https://www.hiascend.com/document/detail/zh/canncommercial/83RC1/softwareinst/instg/instg_0005.html?Mode=PmIns&InstallType=local&OS=Debian&Software=cannToolKit>`_ 或执行以下命令安装：

.. code:: bash

    bash Ascend-hdk-*-npu-driver_*.run --full --force
    bash Ascend-hdk-*-npu-firmware_*.run --full



CANN安装
:::::::::::::

下载 `CANN <https://www.hiascend.com/developer/download/commercial/result?module=cann>`_ ，请根据系统选择`aarch64`或`x86_64`对应版本的`cann-toolkit`、`cann-kernel`和`cann-nnal`。参考 `CANN安装 <https://www.hiascend.com/document/detail/zh/canncommercial/83RC1/softwareinst/instg/instg_0008.html?Mode=PmIns&InstallType=local&OS=Debian&Software=cannToolKit>`_ 或执行以下命令安装：

.. code:: bash

    # 因为版本迭代，包名存在出入，根据实际修改
    bash Ascend-cann-toolkit_8.2.RC1_linux-aarch64.run --install
    bash Ascend-cann-kernels-*_8.2.RC1_linux-aarch64.run --install
    source /usr/local/Ascend/ascend-toolkit/set_env.sh # 安装nnal包需要source环境变量
    bash Ascend-cann-nnal_8.2.RC1_linux-aarch64.run --install
    # 设置环境变量
    source /usr/local/Ascend/ascend-toolkit/set_env.sh
    source /usr/local/Ascend/nnal/atb/set_env.sh

PyTorch+torch_npu 安装    
::::::::::::::::::::::::::

下载 `torch_npu <https://www.hiascend.com/developer/download/community/result?module=pt>`_ ，参考 `Ascend Extension for PyTorch 配置与安装 <https://www.hiascend.com/document/detail/zh/Pytorch/720/configandinstg/instg/insg_0004.html>`_ 或执行以下命令安装：

安装torch和torch_npu，以下以python 3.10 + torch 2.7.1为例：

.. code:: bash

    conda create -n test python=3.10
    conda activate test
    pip install torch-2.7.1-cp310-cp310*.whl 
    pip install torch_npu-2.7.1*-cp310-cp310*.whl
